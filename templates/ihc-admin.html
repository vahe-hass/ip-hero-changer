<div id="wrapper">
    <div class="d-flex flex-column" id="content-wrapper">
        <div id="content">
            <div class="container-fluid">
                <div class="row" id="ihc-first-row">
                    <div class="col">
                        <div class="card ihc-custom-card shadow mb-5">
                            <div class="card-header py-3">
                                <h2 class="text-primary mb-4" style="font-weight: bold;">IP Hero Changer</h2>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-lg-6 d-flex">
                                        <div class="card ihc-custom-card shadow flex-fill">
                                            <div class="card-header d-flex justify-content-between align-items-center py-3">
                                                <h6 class="text-primary fw-bold m-0">Button Impression</h6>
                                            </div>
                                            <div class="card-body">
                                                <div><canvas id="btnImpBar" width="100" height="100"></canvas></div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-lg-6 d-flex">
                                        <div class="card ihc-custom-card shadow flex-fill">
                                            <div class="card-header d-flex justify-content-between align-items-center py-3">
                                                <h6 class="text-primary fw-bold m-0">Button Clicks</h6>
                                            </div>
                                            <div class="card-body">
                                                <div><canvas id="viewPie" width="100" height="100"></canvas></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-lg-4">
                        <div class="card ihc-custom-card mb-3">
                            <div class="card-body shadow">
                                <div class="mb-3"><button id="ihc-delete-btn" class="btn btn-danger" type="button">Delete All Data</button></div>
                            </div>
                        </div>
                        <div class="card ihc-custom-card shadow mb-4">
                            <div class="card-header py-3">
                                <h6 class="text-primary fw-bold m-0"><strong>Data Findings</strong></h6>
                            </div>
                            <div class="card-body">
                                <h4 class="small fw-bold">CTR A<span class="float-end">20%</span></h4>
                                <div class="progress progress-sm mb-3">
                                    <div class="progress-bar bg-danger" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%;"><span class="visually-hidden">40%</span></div>
                                </div>
                                <h4 class="small fw-bold">CTR B<span class="float-end">20%</span></h4>
                                <div class="progress progress-sm mb-3">
                                    <div class="progress-bar bg-warning" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 40%;"><span class="visually-hidden">40%</span></div>
                                </div>
                                <h4 class="small fw-bold">Customer Database<span class="float-end">60%</span></h4>
                                <div class="progress progress-sm mb-3">
                                    <div class="progress-bar bg-primary" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;"><span class="visually-hidden">60%</span></div>
                                </div>
                                <h4 class="small fw-bold">Payout Details<span class="float-end">80%</span></h4>
                                <div class="progress progress-sm mb-3">
                                    <div class="progress-bar bg-info" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%;"><span class="visually-hidden">80%</span></div>
                                </div>
                                <h4 class="small fw-bold">Account setup<span class="float-end">Complete!</span></h4>
                                <div class="progress progress-sm mb-3">
                                    <div class="progress-bar bg-success" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"><span class="visually-hidden">100%</span></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-8">
                        <div class="card ihc-custom-card shadow mb-3">
                            <div class="card-header py-3">
                                <p class="text-primary m-0 fw-bold">Options</p>
                            </div>
                            <div class="card-body">
                                <form id="location-form">
                                    <div class="row">
                                        <div class="col-12 col-md-6">
                                            <div class="mb-3"><label class="form-label"><strong>Region</strong></label><select class="form-select" id="region" onchange="set_country(this,country,city_state)" name="region">
                                                    <option value="" selected="">SELECT REGION</option>
                                                    <option value=""></option>
                                                    <script type="text/javascript">
                                                        setRegions(this);
                                                    </script>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="mb-3"><label class="form-label"><strong>Country</strong><br></label><select class="form-select" id="country" name="country" onchange="set_city_state(this,city_state)" disabled required></select>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 col-md-6">
                                            <div class="mb-3"><label class="form-label"><strong>State</strong><br></label>
                                                <select class="form-select" id="city-state" name="city_state" disabled required>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-12 col-md-6">
                                            <div class="mb-3"><label class="form-label" for="last_name"><strong>Button HEX</strong></label><input class="form-control" type="text" id="btn-color" name="color"
                                                    pattern="^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$" placeholder="Enter a valid hex color (e.g., #RRGGBB)"></div>
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 col-md-6">
                                            <div class="mb-3"><label class="form-label" for="first_name"><strong>Button ID</strong><br></label><input class="form-control" type="text" id="btn-id" name="btnid" required></div>
                                        </div>
                                        <div class="col"></div>
                                    </div>
                                    <div class="mb-3" style="padding-top: 12px;"><button class="btn btn-primary" type="submit">Save Settings</button></div>
                                    <div class="mb-3" style="padding: 10px 0px;font-weight: bold;">
                                        <h5 class="text-center text-success" id="response-message"></h5>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="text/javascript">
    //handle form submission via AJAX
    $(document).ready(function() {
        $("#location-form").submit(function(event) {
            event.preventDefault();

            var formData = {
                region: $('#region').val(),
                country: $("#country").val(),
                city_state: $("#city-state").val(),
                color: $("#btn-color").val(),
                btnid: $("#btn-id").val(),
            };
            $.ajax({
                type: "POST",
                url: "/wp-content/plugins/ip-hero-changer/ihc-process-form.php",
                data: formData,
                success: function(response) {
                    $("#response-message").html(response);
                    $("#location-form")[0].reset();
                    setTimeout(function() {
                        $("#response-message").fadeOut(500, function() {
                            $(this).empty().show();
                        });
                    }, 6000);
                },
                error: function() {
                    $("#response-message").html("An error occurred while processing your request.");
                }
            });
        });
    });

    $(document).ready(function() {
        // Event listener for the delete button
        $('#ihc-delete-btn').on('click', function() {
            // Ask for confirmation before deleting
            if (confirm('Are you sure you want to delete all the data?')) {
                // Make an AJAX request to delete all data
                $.ajax({
                    url: '/wp-content/plugins/ip-hero-changer/ihc-ajax.php', // Replace with the actual path to your PHP file
                    method: 'POST',
                    data: {
                        action: 'delete_all_data'
                    },
                    success: function(response) {
                        // Handle the response from the server
                        alert(response);
                        // You can perform additional actions or update the UI here
                    },
                    error: function(xhr, status, error) {
                        // Handle errors
                        console.error('AJAX error: ' + status, error);
                        alert('Error deleting data.');
                    }
                });
            } else {
                // User canceled the deletion
                alert('Data deletion canceled.');
            }
        });
    });
</script>
<script>
    const impBar = document.getElementById('btnImpBar');
    const data = {
        labels: ['A', 'B'],
        datasets: [{
            label: 'Button Impression',
            data: [ <?php echo $impressionA .
                ', ' . $impressionB; ?>
            ],
            backgroundColor: [
                'rgba(255, 99, 132, 0.2)',
                'rgba(255, 159, 64, 0.2)',
            ],
            borderColor: [
                'rgb(255, 99, 132)',
                'rgb(255, 159, 64)',
            ],
            borderWidth: 1
        }]
    };

    new Chart(impBar, {
        type: 'bar',
        data: data,
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
<script>
    const viewPie = document.getElementById('viewPie');

    new Chart(viewPie, {
        type: 'doughnut',
        data: {
            labels: ['A', 'B'],
            datasets: [{
                label: 'Button Clicks',
                data: [ <?php echo $clickedA .
                    ', ' . $clickedB; ?>
                ],
                borderWidth: 1
            }]
        },
        options: {

        }
    });
</script>
